<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ë°€ë¦¬ì˜ ì„œì¬ AI ê²€ìƒ‰ ì„œë¹„ìŠ¤">
    <title>ë°€ë¦¬ì˜ ì„œì¬ AI ê²€ìƒ‰</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        .slide-up {
            animation: slideUp 0.5s ease-out;
        }

        .pulse-dot {
            animation: pulse-dot 1.4s infinite;
        }

        .bounce {
            animation: bounce 1s infinite;
        }

        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .rotate {
            animation: rotate 2s linear infinite;
        }

        /* ë°€ë¦¬ ë¸Œëœë“œ ì»¬ëŸ¬ */
        .millie-yellow { background-color: #FFD400; }
        .millie-black { background-color: #000000; }
        .text-millie-yellow { color: #FFD400; }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #FFD400;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #E6C000;
        }

        /* Toast Animation */
        @keyframes toast-in {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .toast-in {
            animation: toast-in 0.3s ease-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Mock Data (Enhanced)
        const RAG_LOADING_STAGES = [
            { stage: 'emotion', message: 'ì‚¬ìš©ìì˜ ê°ì •ì„ ë¶„ì„í•˜ê³  ìˆì–´ìš”...', duration: 1000 },
            { stage: 'intent', message: 'ì—ì„¸ì´ ì„œê°€ë¥¼ íƒìƒ‰í•˜ëŠ” ì¤‘...', duration: 1100 },
            { stage: 'matching', message: 'ìµœì ì˜ êµ¬ì ˆì„ ë§¤ì¹­í•˜ê³  ìˆì–´ìš”...', duration: 1200 }
        ];

        const FAILOVER_LOADING_STAGES = [
            { stage: 'internal', message: 'ë°€ë¦¬ ì„œì¬ ë‚´ë¶€ ë°ì´í„°ë² ì´ìŠ¤ ê²€ìƒ‰ ì¤‘...', duration: 3000 },
            { stage: 'transition', message: 'ì•—! ë°€ë¦¬ ì„œì¬ì—ëŠ” ì—†ë„¤ìš”. ì™¸ë¶€ ë„ì„œê´€ì„ ì°¾ì•„ë³¼ê²Œìš”!', duration: 3000 },
            { stage: 'external', message: 'ì „ì„¸ê³„ ë„ì„œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ íƒìƒ‰í•˜ëŠ” ì¤‘...', duration: 2000 }
        ];

        const SEARCH_RESULTS = {
            "íŠ¸ë Œë“œ ì½”ë¦¬ì•„": [
                { id: 1, title: "íŠ¸ë Œë“œ ì½”ë¦¬ì•„ 2025", author: "ê¹€ë‚œë„ ì™¸", coverColor: "#FFD700", summary: "2025ë…„ ëŒ€í•œë¯¼êµ­ íŠ¸ë Œë“œë¥¼ ì˜ˆì¸¡í•˜ëŠ” í•„ë…ì„œ", year: 2024 },
                { id: 2, title: "íŠ¸ë Œë“œ ì½”ë¦¬ì•„ 2024", author: "ê¹€ë‚œë„ ì™¸", coverColor: "#FF6B6B", summary: "ë°€ë ˆë‹ˆì–¼ê³¼ Zì„¸ëŒ€ì˜ ì†Œë¹„ íŠ¸ë Œë“œ ë¶„ì„", year: 2023 },
                { id: 3, title: "90ë…„ìƒì´ ì˜¨ë‹¤", author: "ì„í™íƒ", coverColor: "#4ECDC4", summary: "90ë…„ëŒ€ìƒì˜ ì‚¬ê³ ë°©ì‹ê³¼ ë¼ì´í”„ìŠ¤íƒ€ì¼", year: 2018 },
                { id: 4, title: "ìš”ì¦˜ ì–´ë¥¸ë“¤ì˜ ì‚¬íšŒ", author: "ê¹€ì„ ìš°", coverColor: "#95E1D3", summary: "í˜„ëŒ€ ì‚¬íšŒì˜ íŠ¸ë Œë“œì™€ ë¬¸í™” í˜„ìƒ ë¶„ì„", year: 2023 }
            ]
        };

        const RAG_RECOMMENDATIONS = {
            "ìš°ìš¸": {
                intent: "ê°ì • ì¹˜ìœ ",
                analysis: "ìš°ìš¸í•œ ê°ì •ì„ ëŠë¼ê³  ê³„ì‹œëŠ”êµ°ìš”. í˜¼ìê°€ ì•„ë‹ˆë¼ëŠ” ê±¸ ì•Œë ¤ë“œë¦¬ê³  ì‹¶ì–´ìš”. ì§€ê¸ˆë¶€í„° ì¶”ì²œí•´ë“œë¦´ ì„¸ ê¶Œì˜ ì±…ì€ ê°ê° ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ë‹¹ì‹ ì˜ ë§ˆìŒì„ ì–´ë£¨ë§Œì ¸ì¤„ ê±°ì˜ˆìš”. ì²« ë²ˆì§¸ 'ë¯¸ë“œë‚˜ì‡ ë¼ì´ë¸ŒëŸ¬ë¦¬'ëŠ” ì ˆë§ì˜ ìˆœê°„ì—ì„œë„ ì‚¶ì˜ ê°€ëŠ¥ì„±ì„ ë°œê²¬í•˜ê²Œ í•´ì£¼ëŠ” íŒíƒ€ì§€ ì†Œì„¤ì´ì—ìš”. ë‘ ë²ˆì§¸ 'ë‹¬ëŸ¬êµ¬íŠ¸ ê¿ˆ ë°±í™”ì 'ì€ ì¼ìƒì˜ í”¼ë¡œë¥¼ ìŠê²Œ í•˜ëŠ” ë”°ëœ»í•œ ì´ì•¼ê¸°ë¡œ, ë§ˆì¹˜ ê¿ˆì†ì„ ì—¬í–‰í•˜ë“¯ ë‹¹ì‹ ì„ ì•ˆì „í•œ ê³µê°„ìœ¼ë¡œ ë°ë ¤ê°ˆ ê±°ì˜ˆìš”. ë§ˆì§€ë§‰ìœ¼ë¡œ 'ì–¸ì–´ì˜ ì˜¨ë„'ëŠ” ì§§ì€ ë¬¸ì¥ë“¤ì´ ì£¼ëŠ” ìœ„ë¡œì˜ í˜ì„ ë³´ì—¬ì¤˜ìš”. ê° ë¬¸ì¥ì´ ë‹¹ì‹ ì˜ ë§ˆìŒì— ì‘ì€ ë¹›ì´ ë˜ì–´ì¤„ ê±°ë¼ í™•ì‹ í•´ìš”.",
                books: [
                    {
                        id: 10,
                        title: "ë¯¸ë“œë‚˜ì‡ ë¼ì´ë¸ŒëŸ¬ë¦¬",
                        author: "ë§¤íŠ¸ í—¤ì´ê·¸",
                        coverColor: "#6C5CE7",
                        summary: "ì‚¶ì˜ ì—¬ëŸ¬ ê°€ëŠ¥ì„±ì„ ë³´ì—¬ì£¼ëŠ” íŒíƒ€ì§€ ì†Œì„¤",
                        reason: "ì ˆë§ì˜ ìˆœê°„ì—ì„œ í¬ë§ì„ ë°œê²¬í•˜ëŠ” ì´ì•¼ê¸°. ë‹¤ë¥¸ ì„ íƒì„ í–ˆë‹¤ë©´ ì–´ë• ì„ê¹Œ í•˜ëŠ” ì§ˆë¬¸ì— ëŒ€í•œ ë”°ëœ»í•œ ë‹µë³€ì„ ì œì‹œí•©ë‹ˆë‹¤.",
                        detailedDescription: "ì£¼ì¸ê³µ ë…¸ë¼ëŠ” ì‚¶ì„ í¬ê¸°í•˜ë ¤ëŠ” ìˆœê°„, ë¬´í•œí•œ ì±…ë“¤ì´ ìˆëŠ” ë¯¸ë“œë‚˜ì‡ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ë„ì°©í•©ë‹ˆë‹¤. ê° ì±…ì€ ê·¸ë…€ê°€ ë‹¤ë¥¸ ì„ íƒì„ í–ˆì„ ë•Œì˜ ì‚¶ì„ ë³´ì—¬ì£¼ì£ . ë¡ìŠ¤íƒ€ê°€ ëœ ì‚¶, ë¹™í•˜í•™ìê°€ ëœ ì‚¶, ì‚¬ë‘í–ˆë˜ ì‚¬ëŒê³¼ ê²°í˜¼í•œ ì‚¶... í•˜ì§€ë§Œ ê·¸ ì–´ë–¤ ì‚¶ë„ ì™„ë²½í•˜ì§€ ì•Šì•˜ì–´ìš”."
                    },
                    {
                        id: 11,
                        title: "ë‹¬ëŸ¬êµ¬íŠ¸ ê¿ˆ ë°±í™”ì ",
                        author: "ì´ë¯¸ì˜ˆ",
                        coverColor: "#FD79A8",
                        summary: "ê¿ˆì„ ì‚¬ê³ íŒŒëŠ” ì‹ ë¹„í•œ ë°±í™”ì ì˜ ì´ì•¼ê¸°",
                        reason: "ì¼ìƒì˜ í”¼ë¡œë¥¼ ìŠê²Œ í•˜ëŠ” ë”°ëœ»í•œ íŒíƒ€ì§€. í˜„ì‹¤ì—ì„œ ì ì‹œ ë²—ì–´ë‚˜ ì•ˆì „í•œ ê³µê°„ì—ì„œ íœ´ì‹ì„ ì·¨í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.",
                        detailedDescription: "ì ë“¤ì–´ì•¼ë§Œ ì…ì¥í•  ìˆ˜ ìˆëŠ” ì‹ ë¹„ë¡œìš´ ë°±í™”ì , ë‹¬ëŸ¬êµ¬íŠ¸. ì´ê³³ì—ì„œëŠ” ì˜¨ê°– ì¢…ë¥˜ì˜ ê¿ˆì„ íŒë§¤í•©ë‹ˆë‹¤. ë‹¨ê³¨ ê³ ê°ë“¤ì€ ìì‹ ì´ ì›í•˜ëŠ” ê¿ˆì„ ê³¨ë¼ ì ë“¤ê³ , ê¿ˆ ì œì‘ìë“¤ì€ ìµœê³ ì˜ ê¿ˆì„ ë§Œë“¤ê¸° ìœ„í•´ ë…¸ë ¥í•˜ì£ ."
                    },
                    {
                        id: 12,
                        title: "ì–¸ì–´ì˜ ì˜¨ë„",
                        author: "ì´ê¸°ì£¼",
                        coverColor: "#FDCB6E",
                        summary: "ë§ê³¼ ê¸€ì´ ì „í•˜ëŠ” ë”°ëœ»í•œ ìœ„ë¡œ",
                        reason: "ë§ˆìŒì„ ì–´ë£¨ë§Œì§€ëŠ” ë¬¸ì¥ë“¤ì˜ í˜. ì§§ì§€ë§Œ ê°•ë ¬í•œ ìš¸ë¦¼ì„ ì£¼ëŠ” ê¸€ë“¤ì´ ë‹¹ì‹ ì˜ ê°ì •ì„ ëŒ€ë³€í•´ì¤„ ê±°ì˜ˆìš”.",
                        detailedDescription: "ìš°ë¦¬ê°€ ì¼ìƒì—ì„œ ë¬´ì‹¬ì½” ì§€ë‚˜ì¹˜ëŠ” ë‹¨ì–´ì™€ ë¬¸ì¥ë“¤. í•˜ì§€ë§Œ ê·¸ ì†ì—ëŠ” ë†€ë¼ìš´ ì˜¨ê¸°ê°€ ìˆ¨ì–´ìˆìŠµë‹ˆë‹¤. ì €ìëŠ” 'ê²©ë ¤', 'ìœ„ë¡œ', 'ê³µê°' ê°™ì€ ë‹¨ì–´ë“¤ì´ ì–´ë–»ê²Œ ì‚¬ëŒì˜ ë§ˆìŒì„ ì›€ì§ì´ëŠ”ì§€, ì‹¤ì œ ê²½í—˜ê³¼ ì´ì•¼ê¸°ë¥¼ í†µí•´ ë“¤ë ¤ì¤ë‹ˆë‹¤."
                    }
                ],
                followUpQuestions: ["ë” ìœ„ë¡œê°€ ë˜ëŠ” ì±… ì¶”ì²œí•´ì¤˜", "ì´ ì‘ê°€ì˜ ë‹¤ë¥¸ ì±…ì€?", "ê°ë™ì ì¸ ì†Œì„¤ ì•Œë ¤ì¤˜"]
            },
            "íë§": {
                intent: "ì‹¬ë¦¬ì  ì•ˆì •",
                analysis: "íœ´ì‹ê³¼ ì¹˜ìœ ê°€ í•„ìš”í•œ ì‹œê°„ì´ë„¤ìš”. ë•Œë¡œëŠ” ë©ˆì¶”ê³ , ìˆ¨ ì‰¬ê³ , ë‚˜ ìì‹ ì„ ëŒì•„ë³´ëŠ” ê²ƒì´ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤. ì œê°€ ì¶”ì²œí•˜ëŠ” ì„¸ ê¶Œì˜ ì±…ì€ ë‹¹ì‹ ì—ê²Œ ê·¸ëŸ° ì—¬ìœ ë¥¼ ì„ ë¬¼í•  ê±°ì˜ˆìš”. 'ë‚˜ëŠ” ë‚˜ë¡œ ì‚´ê¸°ë¡œ í–ˆë‹¤'ëŠ” íƒ€ì¸ì˜ ì‹œì„ ì—ì„œ ë²—ì–´ë‚˜ ìì‹ ì˜ ì‚¶ì„ ë˜ì°¾ëŠ” ì´ì•¼ê¸°ë¥¼, 'ë³´ë…¸ë³´ë…¸ì²˜ëŸ¼ ì‚´ë‹¤ë‹ˆ ë‹¤í–‰ì´ì•¼'ëŠ” ì‘ì€ ê²ƒì—ì„œ í–‰ë³µì„ ì°¾ëŠ” ì§€í˜œë¥¼, 'ì£½ê³  ì‹¶ì§€ë§Œ ë–¡ë³¶ì´ëŠ” ë¨¹ê³  ì‹¶ì–´'ëŠ” í˜ë“  ê°ì •ê³¼ í•¨ê»˜ ì‚´ì•„ê°€ëŠ” ìš©ê¸°ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ì´ ì±…ë“¤ì€ ë‹¹ì‹ ì´ ìŠ¤ìŠ¤ë¡œì—ê²Œ ë” ì¹œì ˆí•´ì§ˆ ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤„ ê±°ì˜ˆìš”.",
                books: [
                    { id: 13, title: "ë‚˜ëŠ” ë‚˜ë¡œ ì‚´ê¸°ë¡œ í–ˆë‹¤", author: "ê¹€ìˆ˜í˜„", coverColor: "#74B9FF", summary: "íƒ€ì¸ì˜ ì‹œì„ ì—ì„œ ë²—ì–´ë‚˜ ë‚˜ë‹µê²Œ ì‚¬ëŠ” ë²•", reason: "ìì¡´ê° íšŒë³µì— ë„ì›€ì´ ë˜ëŠ” ì—ì„¸ì´. ë‹¤ë¥¸ ì‚¬ëŒì˜ ê¸°ëŒ€ê°€ ì•„ë‹Œ, ë‚´ê°€ ì›í•˜ëŠ” ì‚¶ì„ ì‚´ì•„ë„ ê´œì°®ë‹¤ëŠ” ìš©ê¸°ë¥¼ ì¤ë‹ˆë‹¤.", detailedDescription: "ì‹¬ë¦¬ìƒë‹´ì‚¬ì¸ ì €ìê°€ ì‹¤ì œ ìƒë‹´ ì‚¬ë¡€ì™€ ìì‹ ì˜ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì“´ ì—ì„¸ì´ì…ë‹ˆë‹¤. 'ì°©í•œ ì‚¬ëŒ ì½¤í”Œë ‰ìŠ¤', 'íƒ€ì¸ì˜ í‰ê°€ì— ëŒ€í•œ ë‘ë ¤ì›€', 'ì™„ë²½ì£¼ì˜' ë“± ìš°ë¦¬ë¥¼ í˜ë“¤ê²Œ í•˜ëŠ” ì‹¬ë¦¬ì  êµ´ë ˆë“¤ì„ í•˜ë‚˜ì”© í’€ì–´ëƒ…ë‹ˆë‹¤." },
                    { id: 14, title: "ë³´ë…¸ë³´ë…¸ì²˜ëŸ¼ ì‚´ë‹¤ë‹ˆ ë‹¤í–‰ì´ì•¼", author: "ê¹€ì‹ íšŒ", coverColor: "#A29BFE", summary: "ë³´ë…¸ë³´ë…¸ì˜ ì² í•™ìœ¼ë¡œ ë°°ìš°ëŠ” ì‚¶ì˜ ì§€í˜œ", reason: "ì¼ìƒ ì† ì‘ì€ í–‰ë³µì„ ë°œê²¬í•˜ê²Œ í•´ì¤˜ìš”. ë³µì¡í•œ ì„¸ìƒì—ì„œ ë‹¨ìˆœí•¨ì˜ ì•„ë¦„ë‹¤ì›€ì„ ì¼ê¹¨ì›Œì¤ë‹ˆë‹¤.", detailedDescription: "í•´ë‹¬ ë³´ë…¸ë³´ë…¸ëŠ” ë§¤ì¼ ë°”ë‹¤ë¥¼ ë°”ë¼ë³´ê³ , ì¹œêµ¬ë“¤ê³¼ ë†€ê³ , ì¡°ê°œë¥¼ ì¤ìŠµë‹ˆë‹¤. ëŒ€ë‹¨í•œ ì¼ì„ í•˜ì§€ ì•Šì•„ë„, íŠ¹ë³„í•œ ì„±ì·¨ê°€ ì—†ì–´ë„, ë³´ë…¸ë³´ë…¸ëŠ” í–‰ë³µí•´ìš”." },
                    { id: 15, title: "ì£½ê³  ì‹¶ì§€ë§Œ ë–¡ë³¶ì´ëŠ” ë¨¹ê³  ì‹¶ì–´", author: "ë°±ì„¸í¬", coverColor: "#FF7675", summary: "ìš°ìš¸ì¦ê³¼ í•¨ê»˜ ì‚´ì•„ê°€ëŠ” ë²•", reason: "ê³µê°ê³¼ ìœ„ë¡œê°€ ê°€ë“í•œ ì‹¬ë¦¬ ì—ì„¸ì´. í˜ë“  ê°ì •ì„ ë¶€ì •í•˜ì§€ ì•Šê³ , ê·¸ê²ƒê³¼ í•¨ê»˜ ì‚´ì•„ê°€ëŠ” ë°©ë²•ì„ ì•Œë ¤ì¤ë‹ˆë‹¤.", detailedDescription: "ì •ì‹ ê³¼ ì „ë¬¸ì˜ì™€ ìš°ìš¸ì¦ í™˜ìì˜ 12ì£¼ê°„ì˜ ìƒë‹´ ê¸°ë¡ì…ë‹ˆë‹¤. 'ì£½ê³  ì‹¶ì„ ë§Œí¼ í˜ë“¤ì§€ë§Œ, ê·¸ë˜ë„ ë–¡ë³¶ì´ëŠ” ë¨¹ê³  ì‹¶ë‹¤'ëŠ” ë¬¸ì¥ì²˜ëŸ¼, ì´ ì±…ì€ ì ˆë§ê³¼ í¬ë§ì´ ê³µì¡´í•˜ëŠ” ì¸ê°„ì˜ ë³µì¡í•œ ë§ˆìŒì„ ìˆëŠ” ê·¸ëŒ€ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤." }
                ],
                followUpQuestions: ["ëª…ìƒì— ë„ì›€ë˜ëŠ” ì±…ì€?", "ìì—°ì— ê´€í•œ ì—ì„¸ì´ ì¶”ì²œí•´ì¤˜", "ë§ˆìŒì´ í¸ì•ˆí•´ì§€ëŠ” ì‹œì§‘ ì°¾ì•„ì¤˜"]
            }
        };

        const FAILOVER_RESPONSES = {
            "han_kang": {
                message: "í•œê°• ì‘ê°€ë‹˜ì˜ ì±…ì€ ì•„ì‰½ê²Œë„ ë°€ë¦¬ì˜ ì„œì¬ì— ì—†ì–´ìš”. í•˜ì§€ë§Œ ë…¸ë²¨ë¬¸í•™ìƒ ìˆ˜ìƒ ì‘ê°€ë¥¼ ì°¾ìœ¼ì…¨ìœ¼ë‹ˆ, ê°™ì€ ì˜ê´‘ì„ ì•ˆì€ ë˜ ë‹¤ë¥¸ ê±°ì¥ì„ ì†Œê°œí•´ë“œë¦´ê²Œìš”. í—ê°€ë¦¬ì˜ ë¼ìŠ¬ë¡œ í¬ë¼ìŠ¤ë‚˜í˜¸ë¥´ì¹´ì´ ì‘ê°€ëŠ” í•œê°• ì‘ê°€ë‹˜ê³¼ í•¨ê»˜ ë…¸ë²¨ë¬¸í•™ìƒ í›„ë³´ë¡œ ì—¬ëŸ¬ ì°¨ë¡€ ê±°ë¡ ëœ ì„¸ê³„ì ì¸ ì‘ê°€ì˜ˆìš”. ê·¸ì˜ ì‘í’ˆë“¤ì€ ì¸ê°„ ì¡´ì¬ì˜ ê·¼ì›ì  ì§ˆë¬¸ì„ ë˜ì§€ë©°, ë…íŠ¹í•œ ë¬¸ì²´ë¡œ í˜„ëŒ€ ë¬¸í•™ì˜ ìƒˆë¡œìš´ ì§€í‰ì„ ì—´ì—ˆìŠµë‹ˆë‹¤.",
                books: [
                    { id: 30, title: "ì‚¬íƒ„ íƒ±ê³ ", author: "ë¼ìŠ¬ë¡œ í¬ë¼ìŠ¤ë‚˜í˜¸ë¥´ì¹´ì´", coverColor: "#2C3E50", summary: "í—ê°€ë¦¬ ì‹œê³¨ ë§ˆì„ì˜ ëª°ë½ê³¼ í¬ë§ì„ ê·¸ë¦° ëŒ€ì„œì‚¬ì‹œ", reason: "ë…¸ë²¨ë¬¸í•™ìƒ ìˆ˜ìƒ ì‘ê°€ì˜ ëŒ€í‘œì‘. í•œê°• ì‘ê°€ë‹˜ì˜ ì„œì •ì ì´ë©´ì„œë„ ì² í•™ì ì¸ ë¬¸ì²´ë¥¼ ì¢‹ì•„í•˜ì‹ ë‹¤ë©´ ê°•ë ¥ ì¶”ì²œí•©ë‹ˆë‹¤.", detailedDescription: "ë¬´ë„ˆì ¸ê°€ëŠ” í—ê°€ë¦¬ì˜ í•œ ë†ì¥ ê³µë™ì²´ë¥¼ ë°°ê²½ìœ¼ë¡œ, ì‚¬ê¸°ê¾¼ ì´ë¦¬ë¯¸ì•„ì‰¬ê°€ ëŒì•„ì˜¤ë©´ì„œ ë²Œì–´ì§€ëŠ” ì´ì•¼ê¸°ì…ë‹ˆë‹¤. í¬ë¼ìŠ¤ë‚˜í˜¸ë¥´ì¹´ì´ íŠ¹ìœ ì˜ ê¸´ ë¬¸ì¥ê³¼ ë°˜ë³µì  ë¦¬ë“¬ì€ ë§ˆì¹˜ íƒ±ê³ ë¥¼ ì¶”ë“¯ ë…ìë¥¼ ëª°ì…ì‹œí‚¤ì£ . ì‚¬íšŒì£¼ì˜ ì²´ì œ ë¶•ê´´ ì´í›„ì˜ ì ˆë§ê³¼ í¬ë§, ì¸ê°„ì˜ ë‚˜ì•½í•¨ê³¼ ìœ„ëŒ€í•¨ì´ êµì°¨í•˜ëŠ” ì´ ì†Œì„¤ì€ ì½ëŠ” ë‚´ë‚´ ê°•ë ¬í•œ ì¹´íƒ€ë¥´ì‹œìŠ¤ë¥¼ ì„ ì‚¬í•©ë‹ˆë‹¤. ë²¨ë¼ íƒ€ë¥´ ê°ë…ì´ 7ì‹œê°„ì§œë¦¬ ì˜í™”ë¡œ ë§Œë“  ê²ƒìœ¼ë¡œë„ ìœ ëª…í•´ìš”." },
                    { id: 31, title: "ì €í•­ì˜ ë©œë‘ì½œë¦¬ì•„", author: "ë¼ìŠ¬ë¡œ í¬ë¼ìŠ¤ë‚˜í˜¸ë¥´ì¹´ì´", coverColor: "#34495E", summary: "ë¬¸ëª…ì˜ ì¢…ë§ê³¼ ì¸ê°„ ë³¸ì„±ì— ëŒ€í•œ ë¬µì‹œë¡ì  ìš°í™”", reason: "ì² í•™ì  ê¹Šì´ê°€ ìˆëŠ” ë¬¸í•™ì„ ì›í•˜ì‹ ë‹¤ë©´ ì´ ì±…ì…ë‹ˆë‹¤. ì„¸ê³„ì˜ ë¶•ê´´ ì†ì—ì„œë„ ë¹›ë‚˜ëŠ” ì¸ê°„ì„±ì„ íƒêµ¬í•©ë‹ˆë‹¤.", detailedDescription: "í•œ ì‘ì€ ë§ˆì„ì— ê±°ëŒ€í•œ ê³ ë˜ ì‚¬ì²´ê°€ ë„ì°©í•˜ë©´ì„œ ì‹œì‘ë˜ëŠ” í˜¼ë€ê³¼ í­ë ¥ì˜ ì´ì•¼ê¸°ì…ë‹ˆë‹¤. ê³ ë˜ëŠ” ë¬¸ëª…ì˜ ë¶•ê´´ë¥¼ ìƒì§•í•˜ê³ , ì‚¬ëŒë“¤ì€ ì›ì´ˆì  ì•¼ë§Œì„±ì„ ë“œëŸ¬ë‚´ê¸° ì‹œì‘í•˜ì£ . í•˜ì§€ë§Œ ê·¸ ì†ì—ì„œë„ ìŒì•…ê°€ ë°œë¼ìŠ¤ì¹´ëŠ” ì§ˆì„œì™€ ì•„ë¦„ë‹¤ì›€ì„ ì§€í‚¤ë ¤ ì• ì”ë‹ˆë‹¤. ì´ ì†Œì„¤ì€ ë‹¨ìˆœí•œ ë””ìŠ¤í† í”¼ì•„ê°€ ì•„ë‹ˆë¼, ì˜ˆìˆ ê³¼ ì§€ì„±ì´ ì–´ë–»ê²Œ ì¸ê°„ì„ êµ¬ì›í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ì² í•™ì  ëª…ìƒì…ë‹ˆë‹¤." },
                    { id: 32, title: "ì „ìŸê³¼ ì „ìŸ", author: "ë¼ìŠ¬ë¡œ í¬ë¼ìŠ¤ë‚˜í˜¸ë¥´ì¹´ì´", coverColor: "#5D6D7E", summary: "í•œ ë‚¨ìì˜ ì§‘ë…ê³¼ ê´‘ê¸°ê°€ ë¹šì–´ë‚¸ ë¬¸í•™ì  ê±¸ì‘", reason: "ì¸ê°„ì˜ ì§‘ì°©ê³¼ ìˆœìˆ˜í•¨ì„ ë™ì‹œì— ê·¸ë¦° ì‘í’ˆ. ë¬¸í•™ì´ ë¬´ì—‡ì¸ì§€, ì§„ì •í•œ ì˜ˆìˆ ì´ ë¬´ì—‡ì¸ì§€ ì§ˆë¬¸ì„ ë˜ì§‘ë‹ˆë‹¤.", detailedDescription: "ì‘ì€ ë„ì‹œì˜ ì•„ì¹´ì´ë¸Œ ë‹´ë‹¹ì ì½”ë¦°ì€ ìì‹ ì´ ë°œê²¬í•œ ì›ê³ ê°€ ì„¸ê³„ë¥¼ êµ¬í•  ê²ƒì´ë¼ ë¯¿ìŠµë‹ˆë‹¤. ê·¸ëŠ” ì´ ì›ê³ ë¥¼ ì§€í‚¤ê¸° ìœ„í•´ ë‰´ìš•ê¹Œì§€ ì—¬í–‰í•˜ë©°, ê·¸ì˜ ì—¬ì •ì€ ì ì  ë” ê¸°ì´í•˜ê³  ê°•ë°•ì ìœ¼ë¡œ ë³€í•´ê°€ì£ . ì´ ì†Œì„¤ì€ ì˜ˆìˆ ì— ëŒ€í•œ ìˆœìˆ˜í•œ ë¯¿ìŒê³¼ í˜„ì‹¤ì˜ ë¬´ê´€ì‹¬ ì‚¬ì´ì˜ ê°„ê·¹ì„ ì½”ë¯¹í•˜ë©´ì„œë„ ë¹„ê·¹ì ìœ¼ë¡œ ê·¸ë ¤ëƒ…ë‹ˆë‹¤. ëˆí‚¤í˜¸í…Œì˜ í˜„ëŒ€íŒì´ë¼ ë¶ˆë¦´ ë§Œí¼, ì´ìƒì£¼ì˜ì™€ í˜„ì‹¤ì£¼ì˜ì˜ ì¶©ëŒì„ ì˜ˆë¦¬í•˜ê²Œ í¬ì°©í•œ ì‘í’ˆì…ë‹ˆë‹¤." }
                ],
                followUpQuestions: ["ë…¸ë²¨ë¬¸í•™ìƒ ìˆ˜ìƒì‘ ë” ì¶”ì²œí•´ì¤˜", "ë™ìœ ëŸ½ ë¬¸í•™ ì•Œë ¤ì¤˜", "ì² í•™ì ì¸ ì†Œì„¤ ì°¾ì•„ì¤˜"]
            },
            default: {
                message: "ì´ ì±…ì€ ë°€ë¦¬ì˜ ì„œì¬ì— ì•„ì§ ì—†ì–´ìš”. í•˜ì§€ë§Œ ê±±ì • ë§ˆì„¸ìš”! ì „ì„¸ê³„ ë„ì„œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë’¤ì ¸ì„œ ë¹„ìŠ·í•œ ì£¼ì œì™€ ê°ì„±ì˜ ì±…ë“¤ì„ ì°¾ì•„ì™”ì–´ìš”.",
                books: [
                    { id: 20, title: "ì´ì²˜ëŸ¼ ì‚¬ì†Œí•œ ê²ƒë“¤", author: "í´ë ˆì–´ í‚¤ê±´", coverColor: "#DFE6E9", summary: "ì†Œë°•í•˜ì§€ë§Œ ê¹Šì€ ìš¸ë¦¼ì„ ì£¼ëŠ” ë‹¨í¸ì§‘", reason: "í¬ê·€ë³¸ ëŒ€ì‹  ì¶”ì²œí•˜ëŠ” ë¬¸í•™ ì‘í’ˆ. ì§§ì§€ë§Œ ê°•ë ¬í•œ ê°ë™ì„ ì£¼ëŠ” ì´ì•¼ê¸°ë“¤ë¡œ ê°€ë“í•©ë‹ˆë‹¤.", detailedDescription: "ì•„ì¼ëœë“œì˜ ì‘ì€ ë§ˆì„ì„ ë°°ê²½ìœ¼ë¡œ í•œ ë‹¨í¸ ì†Œì„¤ë“¤ì…ë‹ˆë‹¤. í‰ë²”í•œ ì‚¬ëŒë“¤ì˜ ì¼ìƒ ì†ì— ìˆ¨ê²¨ì§„ ë¹„ë°€, ë§í•˜ì§€ ëª»í•œ ê°ì •ë“¤ì´ ì„¬ì„¸í•˜ê²Œ ê·¸ë ¤ì ¸ ìˆì–´ìš”. íŠ¹íˆ í‘œì œì‘ 'ì´ì²˜ëŸ¼ ì‚¬ì†Œí•œ ê²ƒë“¤'ì€ í•œ ì†Œë…€ê°€ ì—¬ë¦„ ë°©í•™ ë™ì•ˆ ì¹œì²™ ì§‘ì— ë¨¸ë¬¼ë©° ê²ªëŠ” ì‘ì€ ë³€í™”ë¥¼ ë‹´ê³  ìˆëŠ”ë°, ì½ê³  ë‚˜ë©´ ê°€ìŠ´ì´ ë¨¹ë¨¹í•´ì§‘ë‹ˆë‹¤." },
                    { id: 21, title: "ë¶ˆí¸í•œ í¸ì˜ì ", author: "ê¹€í˜¸ì—°", coverColor: "#FAB1A0", summary: "í¸ì˜ì ì—ì„œ í¼ì³ì§€ëŠ” ë”°ëœ»í•œ ì¸ê°„ ë“œë¼ë§ˆ", reason: "í•œêµ­ ë…ìë“¤ì´ ì‚¬ë‘í•œ ë² ìŠ¤íŠ¸ì…€ëŸ¬. ì‚¬íšŒ ì†Œì™¸ ê³„ì¸µì˜ ì´ì•¼ê¸°ë¥¼ ë”°ëœ»í•˜ê²Œ ë‹´ì•„ëƒˆìŠµë‹ˆë‹¤.", detailedDescription: "ì„œìš¸ ë³€ë‘ë¦¬ í¸ì˜ì ì—ì„œ ì¼í•˜ê²Œ ëœ ë…ê±°ë…¸ì¸ê³¼ ì²­ë…„ì˜ ì´ì•¼ê¸°ì…ë‹ˆë‹¤. ì‚¬íšŒì—ì„œ ë°€ë ¤ë‚œ ë‘ ì‚¬ëŒì´ í¸ì˜ì ì´ë¼ëŠ” ì‘ì€ ê³µê°„ì—ì„œ ë§Œë‚˜ ì„œë¡œì˜ ìƒì²˜ë¥¼ ì–´ë£¨ë§Œì§€ë©° ì„±ì¥í•´ê°€ëŠ” ê³¼ì •ì´ ê°ë™ì ì´ì—ìš”. 'ë¶ˆí¸í•œ í¸ì˜ì 'ì´ë¼ëŠ” ì œëª©ì²˜ëŸ¼, ì´ ì‚¬íšŒì˜ ë¶ˆí¸í•œ ì§„ì‹¤ë“¤ì„ ì§ì‹œí•˜ë©´ì„œë„, ê·¸ ì•ˆì—ì„œ í”¼ì–´ë‚˜ëŠ” í¬ë§ê³¼ ì—°ëŒ€ì˜ ë©”ì‹œì§€ë¥¼ ì „í•©ë‹ˆë‹¤." },
                    { id: 22, title: "ì‘ë³„í•˜ì§€ ì•ŠëŠ”ë‹¤", author: "í•œê°•", coverColor: "#74B9FF", summary: "ìƒê³¼ ì£½ìŒ, ì´ë³„ì— ëŒ€í•œ ì„œì •ì  ì‚°ë¬¸", reason: "ë¬¸í•™ì  ê¹Šì´ê°€ ìˆëŠ” ëŒ€ì²´ ì¶”ì²œ. ë…¸ë²¨ë¬¸í•™ìƒ ìˆ˜ìƒ ì‘ê°€ì˜ ì² í•™ì  ì„±ì°°ì´ ë‹´ê¸´ ì—ì„¸ì´ì…ë‹ˆë‹¤.", detailedDescription: "ì†Œì„¤ê°€ í•œê°•ì´ ë¨¼ì € ë– ë‚œ ì´ë“¤ì„ ë– ì˜¬ë¦¬ë©° ì“´ ì‚°ë¬¸ì§‘ì…ë‹ˆë‹¤. ì£½ìŒì´ë¼ëŠ” ì ˆëŒ€ì  ì´ë³„ ì•ì—ì„œë„, ìš°ë¦¬ëŠ” ì •ë§ë¡œ 'ì‘ë³„'í•  ìˆ˜ ìˆì„ê¹Œìš”? ì €ìëŠ” ì‚¬ë¼ì§„ ì´ë“¤ì´ ì—¬ì „íˆ ìš°ë¦¬ ì•ˆì— ì‚´ì•„ìˆë‹¤ê³ , ê·¸ë˜ì„œ ì§„ì •í•œ ì‘ë³„ì€ ì—†ë‹¤ê³  ë§í•©ë‹ˆë‹¤. ì‹œì ì¸ ë¬¸ì¥ë“¤ë¡œ ê°€ë“í•œ ì´ ì±…ì€, ìƒì‹¤ì˜ ì•„í””ì„ ê²ªê³  ìˆëŠ” ëª¨ë“  ì´ë“¤ì—ê²Œ ê¹Šì€ ìœ„ë¡œë¥¼ ì „í•´ìš”." }
                ],
                followUpQuestions: ["ìµœê·¼ í™”ì œì˜ ì±… ë³´ì—¬ì¤˜", "ë°€ë¦¬ ë² ìŠ¤íŠ¸ì…€ëŸ¬ëŠ”?", "ë¬¸í•™ìƒ ìˆ˜ìƒì‘ ì¶”ì²œí•´ì¤˜"]
            }
        };

        function detectSearchType(query) {
            const lowerQuery = query.toLowerCase();
            if (lowerQuery.includes('ì¶”ì²œ') || lowerQuery.includes('ìš°ìš¸') || lowerQuery.includes('íë§') || lowerQuery.includes('ìœ„ë¡œ') || lowerQuery.includes('ì½ê¸° ì¢‹ì€') || lowerQuery.includes('ì•Œë ¤ì¤˜')) return 'RAG';
            if (lowerQuery.includes('í•œê°•') || lowerQuery.includes('í¬ê·€') || lowerQuery.includes('ì ˆíŒ') || lowerQuery.includes('ê³ ì„œ') || lowerQuery.includes('ì°¾ê¸° í˜ë“ ')) return 'FAILOVER';
            return 'BM25';
        }

        function getFailoverType(query) {
            const lowerQuery = query.toLowerCase();
            if (lowerQuery.includes('í•œê°•')) return 'han_kang';
            return 'default';
        }

        function extractEmotion(query) {
            if (query.includes('ìš°ìš¸') || query.includes('ìŠ¬í””') || query.includes('ì™¸ë¡œ')) return 'ìš°ìš¸';
            if (query.includes('íë§') || query.includes('ìœ„ë¡œ') || query.includes('í‰í™”')) return 'íë§';
            return 'ìš°ìš¸';
        }

        // Icon Components
        const SearchIcon = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>);
        const BookIcon = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>);
        const MenuIcon = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>);
        const XIcon = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>);
        const SparklesIcon = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 3v18M3 12h18M5.6 5.6l12.8 12.8M18.4 5.6L5.6 18.4"></path></svg>);
        const GlobeIcon = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>);

        // Multi-Stage Loading Component
        const MultiStageLoading = ({ stages, currentStageIndex }) => {
            if (currentStageIndex >= stages.length) return null;
            const currentStage = stages[currentStageIndex];

            return (
                <div className="flex flex-col items-center justify-center py-12 fade-in">
                    <div className="flex space-x-2 mb-4">
                        <div className="w-3 h-3 bg-yellow-400 rounded-full pulse-dot" style={{ animationDelay: '0s' }}></div>
                        <div className="w-3 h-3 bg-yellow-400 rounded-full pulse-dot" style={{ animationDelay: '0.2s' }}></div>
                        <div className="w-3 h-3 bg-yellow-400 rounded-full pulse-dot" style={{ animationDelay: '0.4s' }}></div>
                    </div>
                    <p className="text-gray-600 text-center text-sm font-medium">{currentStage.message}</p>
                    <div className="mt-4 flex gap-2">
                        {stages.map((_, idx) => (
                            <div
                                key={idx}
                                className={`w-2 h-2 rounded-full ${idx <= currentStageIndex ? 'bg-yellow-400' : 'bg-gray-300'}`}
                            />
                        ))}
                    </div>
                </div>
            );
        };

        // Toast Notification
        const Toast = ({ message, type = 'info' }) => (
            <div className={`fixed top-20 left-1/2 transform -translate-x-1/2 z-50 toast-in ${type === 'warning' ? 'bg-orange-500' : 'bg-blue-500'} text-white px-6 py-3 rounded-lg shadow-2xl`}>
                <p className="font-semibold">{message}</p>
            </div>
        );

        // External Search UI
        const ExternalSearchUI = () => (
            <div className="bg-gradient-to-r from-purple-100 to-blue-100 rounded-2xl p-6 mb-6 slide-up border-2 border-purple-300">
                <div className="flex items-center space-x-3 mb-3">
                    <div className="rotate">
                        <GlobeIcon />
                    </div>
                    <h3 className="font-bold text-purple-900">ì™¸ë¶€ ë„ì„œê´€ íƒìƒ‰ ì¤‘</h3>
                </div>
                <p className="text-purple-700 text-sm">ì „ì„¸ê³„ ë„ì„œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë¹„ìŠ·í•œ ì±…ì„ ì°¾ê³  ìˆì–´ìš”...</p>
            </div>
        );

        // Book Card Component (Enhanced with Reason Badge)
        const BookCard = ({ book, showReason = false, showDetailedDesc = false }) => (
            <div className="bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow fade-in">
                <div className="h-48 flex items-center justify-center text-white text-xl font-bold" style={{ backgroundColor: book.coverColor }}>
                    <BookIcon />
                </div>
                <div className="p-4">
                    <h3 className="font-bold text-lg text-gray-900 mb-1">{book.title}</h3>
                    <p className="text-gray-600 text-sm mb-2">{book.author}</p>
                    <p className="text-gray-500 text-xs mb-3">{book.summary}</p>

                    {showReason && book.reason && (
                        <div className="mb-3 p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-400">
                            <p className="text-xs text-gray-800 flex items-start">
                                <span className="mr-2 text-yellow-600">ğŸ’¡</span>
                                <span className="font-medium">{book.reason}</span>
                            </p>
                        </div>
                    )}

                    {showDetailedDesc && book.detailedDescription && (
                        <div className="mb-3 p-3 bg-gray-50 rounded-lg">
                            <p className="text-xs text-gray-700 leading-relaxed">{book.detailedDescription}</p>
                        </div>
                    )}

                    <button className="w-full bg-yellow-400 hover:bg-yellow-500 text-black font-semibold py-2 rounded-lg transition-colors">
                        ë‚´ ì„œì¬ ë‹´ê¸°
                    </button>
                </div>
            </div>
        );

        // AI Streaming Response
        const AIStreamingResponse = ({ text, isComplete }) => {
            const [displayedText, setDisplayedText] = useState('');
            const [currentIndex, setCurrentIndex] = useState(0);

            useEffect(() => {
                if (currentIndex < text.length) {
                    const timeout = setTimeout(() => {
                        setDisplayedText(prev => prev + text[currentIndex]);
                        setCurrentIndex(prev => prev + 1);
                    }, 25);
                    return () => clearTimeout(timeout);
                }
            }, [currentIndex, text]);

            return (
                <div className="bg-gradient-to-r from-yellow-50 to-white rounded-2xl p-6 mb-6 fade-in border-l-4 border-yellow-400">
                    <div className="flex items-start space-x-3">
                        <div className="bg-yellow-400 rounded-full p-2 flex-shrink-0">
                            <SparklesIcon />
                        </div>
                        <div className="flex-1">
                            <p className="text-gray-800 leading-relaxed">
                                {displayedText}
                                {!isComplete && currentIndex < text.length && <span className="typing-cursor"></span>}
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // Follow-up Chips
        const FollowUpChips = ({ questions, onQuestionClick }) => (
            <div className="mb-6 fade-in">
                <p className="text-sm text-gray-600 mb-3 font-semibold">ğŸ’¡ ì´ëŸ° ì§ˆë¬¸ì€ ì–´ë•Œìš”?</p>
                <div className="flex flex-wrap gap-2">
                    {questions.map((q, idx) => (
                        <button key={idx} onClick={() => onQuestionClick(q)} className="px-4 py-2 bg-white border-2 border-yellow-400 text-gray-800 rounded-full text-sm hover:bg-yellow-50 transition-colors">
                            {q}
                        </button>
                    ))}
                </div>
            </div>
        );

        // History Sidebar
        const HistorySidebar = ({ isOpen, onClose, history, onSelectHistory }) => {
            if (!isOpen) return null;
            return (
                <>
                    <div className="fixed inset-0 bg-black bg-opacity-50 z-40" onClick={onClose}></div>
                    <div className="fixed top-0 left-0 h-full w-80 bg-white shadow-2xl z-50 slide-in overflow-y-auto">
                        <div className="p-6">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-xl font-bold text-gray-900">ëŒ€í™” ê¸°ë¡</h2>
                                <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-lg transition-colors"><XIcon /></button>
                            </div>
                            {history.length === 0 ? (
                                <p className="text-gray-500 text-center py-8">ì•„ì§ ëŒ€í™” ê¸°ë¡ì´ ì—†ì–´ìš”</p>
                            ) : (
                                <div className="space-y-3">
                                    {history.map((item, idx) => (
                                        <button key={idx} onClick={() => { onSelectHistory(item); onClose(); }} className="w-full text-left p-4 bg-gray-50 hover:bg-yellow-50 rounded-lg transition-colors">
                                            <p className="font-medium text-gray-900 mb-1 truncate">{item.query}</p>
                                            <p className="text-xs text-gray-500">{new Date(item.timestamp).toLocaleString('ko-KR')}</p>
                                        </button>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </>
            );
        };

        // Main App
        const App = () => {
            const [query, setQuery] = useState('');
            const [searchState, setSearchState] = useState('idle'); // idle, searching, analyzing, complete
            const [currentStageIndex, setCurrentStageIndex] = useState(0);
            const [results, setResults] = useState(null);
            const [history, setHistory] = useState([]);
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);
            const [streamingText, setStreamingText] = useState('');
            const [isStreamComplete, setIsStreamComplete] = useState(false);
            const [showToast, setShowToast] = useState(false);
            const [toastMessage, setToastMessage] = useState('');
            const [showExternalUI, setShowExternalUI] = useState(false);

            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            useEffect(() => {
                scrollToBottom();
            }, [results]);

            const handleSearch = async (searchQuery) => {
                if (!searchQuery.trim()) return;

                const type = detectSearchType(searchQuery);
                setSearchState('searching');
                setResults(null);
                setCurrentStageIndex(0);
                setStreamingText('');
                setIsStreamComplete(false);
                setShowToast(false);
                setShowExternalUI(false);

                setHistory(prev => [{ query: searchQuery, timestamp: Date.now(), type }, ...prev]);

                if (type === 'BM25') {
                    // Case A: Zero Latency - ì¦‰ì‹œ ê²°ê³¼
                    await new Promise(resolve => setTimeout(resolve, 100)); // 0.1ì´ˆ
                    setSearchState('complete');
                    setResults({
                        type: 'BM25',
                        books: SEARCH_RESULTS["íŠ¸ë Œë“œ ì½”ë¦¬ì•„"]
                    });
                } else if (type === 'RAG') {
                    // Case B: 3ì´ˆ ì´ìƒ ë‹¤ë‹¨ê³„ ë¶„ì„
                    const stages = RAG_LOADING_STAGES;

                    for (let i = 0; i < stages.length; i++) {
                        setCurrentStageIndex(i);
                        await new Promise(resolve => setTimeout(resolve, stages[i].duration));
                    }

                    const emotion = extractEmotion(searchQuery);
                    const ragData = RAG_RECOMMENDATIONS[emotion];

                    // ë¡œë”© ì™„ë£Œ í›„ ê²°ê³¼ ë¨¼ì € ì„¤ì •
                    setResults({
                        type: 'RAG',
                        intent: ragData.intent,
                        analysis: ragData.analysis,
                        books: ragData.books,
                        followUpQuestions: ragData.followUpQuestions
                    });

                    setSearchState('complete');
                    setStreamingText(ragData.analysis);

                    // ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ëŒ€ê¸°
                    await new Promise(resolve => setTimeout(resolve, ragData.analysis.length * 25 + 500));
                    setIsStreamComplete(true);
                } else {
                    // Case C: 2-Step Failover
                    const stages = FAILOVER_LOADING_STAGES;

                    // Step 1: ë‚´ë¶€ ê²€ìƒ‰
                    setCurrentStageIndex(0);
                    await new Promise(resolve => setTimeout(resolve, stages[0].duration));

                    // Step 2: ì „í™˜ í† ìŠ¤íŠ¸
                    setCurrentStageIndex(1);
                    setShowToast(true);
                    setToastMessage(stages[1].message);
                    await new Promise(resolve => setTimeout(resolve, stages[1].duration));
                    setShowToast(false);

                    // Step 3: ì™¸ë¶€ íƒìƒ‰ UI
                    setCurrentStageIndex(2);
                    setShowExternalUI(true);
                    await new Promise(resolve => setTimeout(resolve, stages[2].duration));

                    // ëª¨ë“  ë¡œë”© ì™„ë£Œ í›„ì—ë§Œ ê²°ê³¼ ì„¤ì •
                    setShowExternalUI(false);
                    setSearchState('complete');
                    const failoverType = getFailoverType(searchQuery);
                    const failoverData = FAILOVER_RESPONSES[failoverType];

                    setResults({
                        type: 'FAILOVER',
                        message: failoverData.message,
                        books: failoverData.books,
                        followUpQuestions: failoverData.followUpQuestions
                    });
                }
            };

            const handleFollowUpQuestion = (question) => {
                setQuery(question);
                handleSearch(question);
            };

            const isLoading = searchState === 'searching';

            return (
                <div className="min-h-screen bg-gradient-to-br from-yellow-50 via-white to-gray-50">
                    {/* Toast */}
                    {showToast && <Toast message={toastMessage} type="warning" />}

                    {/* Header */}
                    <header className="bg-black text-white p-4 sticky top-0 z-30 shadow-lg">
                        <div className="max-w-4xl mx-auto flex items-center justify-between">
                            <button onClick={() => setIsSidebarOpen(true)} className="p-2 hover:bg-gray-800 rounded-lg transition-colors">
                                <MenuIcon />
                            </button>
                            <h1 className="text-2xl font-bold flex items-center space-x-2">
                                <BookIcon />
                                <span>ë°€ë¦¬ì˜ ì„œì¬</span>
                                <span className="text-yellow-400 text-sm">AI</span>
                            </h1>
                            <div className="w-10"></div>
                        </div>
                    </header>

                    {/* History Sidebar */}
                    <HistorySidebar isOpen={isSidebarOpen} onClose={() => setIsSidebarOpen(false)} history={history} onSelectHistory={(item) => { setQuery(item.query); handleSearch(item.query); }} />

                    {/* Main Content */}
                    <main className="max-w-4xl mx-auto p-4 pb-24">
                        {/* Welcome */}
                        {!results && !isLoading && (
                            <div className="text-center py-16 fade-in">
                                <div className="text-6xl mb-4">ğŸ“š</div>
                                <h2 className="text-3xl font-bold text-gray-900 mb-3">ì–´ë–¤ ì±…ì„ ì°¾ìœ¼ì‹œë‚˜ìš”?</h2>
                                <p className="text-gray-600 mb-8">ì±… ì œëª©, ì‘ê°€, ë˜ëŠ” ì›í•˜ëŠ” ê°ì„±ì„ ììœ ë¡­ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”</p>
                                <div className="flex flex-wrap gap-2 justify-center">
                                    <button onClick={() => handleSearch("íŠ¸ë Œë“œ ì½”ë¦¬ì•„ 2025")} className="px-4 py-2 bg-white border border-gray-200 rounded-full text-sm hover:bg-gray-50">íŠ¸ë Œë“œ ì½”ë¦¬ì•„ 2025</button>
                                    <button onClick={() => handleSearch("ìš°ìš¸í•  ë•Œ ì½ê¸° ì¢‹ì€ ì—ì„¸ì´ ì¶”ì²œí•´ì¤˜")} className="px-4 py-2 bg-white border border-gray-200 rounded-full text-sm hover:bg-gray-50">ìš°ìš¸í•  ë•Œ ì½ê¸° ì¢‹ì€ ì—ì„¸ì´</button>
                                    <button onClick={() => handleSearch("í•œê°• ì‘ê°€ë‹˜ ì±… ë³´ì—¬ì¤˜")} className="px-4 py-2 bg-white border border-gray-200 rounded-full text-sm hover:bg-gray-50">í•œê°• ì‘ê°€ë‹˜ ì±… ë³´ì—¬ì¤˜</button>
                                </div>
                            </div>
                        )}

                        {/* Search Results */}
                        {(isLoading || results) && (
                            <div className="mt-6">
                                {/* User Query Chat Bubble */}
                                <div className="flex justify-end mb-6 fade-in">
                                    <div className="bg-yellow-400 rounded-2xl px-5 py-3 max-w-md shadow-md">
                                        <p className="text-gray-900 font-medium">{query}</p>
                                    </div>
                                </div>

                                {/* Loading */}
                                {isLoading && (
                                    <>
                                        {results?.type === 'RAG' || detectSearchType(query) === 'RAG' ? (
                                            <MultiStageLoading stages={RAG_LOADING_STAGES} currentStageIndex={currentStageIndex} />
                                        ) : results?.type === 'FAILOVER' || detectSearchType(query) === 'FAILOVER' ? (
                                            <MultiStageLoading stages={FAILOVER_LOADING_STAGES} currentStageIndex={currentStageIndex} />
                                        ) : null}
                                    </>
                                )}

                                {/* External UI */}
                                {showExternalUI && <ExternalSearchUI />}

                                {/* Results */}
                                {results && (
                                    <>
                                        {results.type === 'RAG' && (
                                            <AIStreamingResponse text={streamingText} isComplete={isStreamComplete} />
                                        )}

                                        {results.type === 'FAILOVER' && (
                                            <div className="bg-gradient-to-r from-orange-50 to-yellow-50 rounded-2xl p-6 mb-6 fade-in border-l-4 border-orange-400">
                                                <p className="text-gray-800 font-medium">{results.message}</p>
                                            </div>
                                        )}

                                        {/* Books */}
                                        <div className={`grid grid-cols-1 ${results.type === 'BM25' ? 'md:grid-cols-3' : 'md:grid-cols-2'} gap-4 mb-6`}>
                                            {results.books?.map(book => (
                                                <BookCard
                                                    key={book.id}
                                                    book={book}
                                                    showReason={results.type === 'RAG' || results.type === 'FAILOVER'}
                                                    showDetailedDesc={results.type === 'FAILOVER'}
                                                />
                                            ))}
                                        </div>

                                        {results.followUpQuestions && (
                                            <FollowUpChips questions={results.followUpQuestions} onQuestionClick={handleFollowUpQuestion} />
                                        )}
                                    </>
                                )}

                                <div ref={messagesEndRef} />
                            </div>
                        )}
                    </main>

                    {/* Fixed Search Bar */}
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg">
                        <div className="max-w-4xl mx-auto">
                            <form onSubmit={(e) => { e.preventDefault(); handleSearch(query); }} className="flex space-x-2">
                                <input type="text" value={query} onChange={(e) => setQuery(e.target.value)} placeholder="ì±… ì œëª©, ì‘ê°€, ë˜ëŠ” ì›í•˜ëŠ” ê°ì„±ì„ ì…ë ¥í•˜ì„¸ìš”..." className="flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-yellow-400 focus:outline-none" />
                                <button type="submit" disabled={isLoading || !query.trim()} className="bg-yellow-400 hover:bg-yellow-500 text-black font-bold px-6 py-3 rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center">
                                    <SearchIcon />
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
